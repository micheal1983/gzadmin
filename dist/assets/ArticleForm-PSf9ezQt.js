import{_ as w,i as x,c as d,a as o,t as A,p as k,w as n,v,f as U,q as b,h as y,s as N,x as C,u as D,j as m,o as c}from"./index-J5bTViEi.js";import{a as f}from"./article-CU4BPepM.js";import{c as R}from"./channel-DtUzXAka.js";import{C as M}from"./UploadImage-S9Ja6SXK.js";import"./request-CgiPNpti.js";const S={class:"article-form"},B={class:"header"},J={key:0,class:"loading"},L={key:1,class:"form-container"},O={class:"form-item"},T={class:"form-row"},j={class:"form-item flex-1"},E={class:"form-item flex-1"},F={class:"form-item"},I={class:"form-item"},q={class:"radio-group"},H={__name:"ArticleForm",setup($){const g=N(),p=D(),i=m(!1),r=g.params.id,u=C(()=>!!r),l=m({title:"",channel_id:1,author:"Admin",content:"",cover:"",status:1}),V=m([]),_=async()=>{i.value=!0;try{const a=await R.getList();if(a&&a.code===200&&(V.value=a.data),u.value){const t=await f.getDetail(r);if(t&&t.code===200){const e=t.data;let s={author:"Admin",content:"",cover:""};try{e.info&&(s=typeof e.info=="string"?JSON.parse(e.info):e.info)}catch{s.content=e.info||""}l.value={title:e.name,channel_id:e.channel_id,author:s.author||"Admin",content:s.content||"",cover:s.cover||"",status:Number(e.status)}}}}catch(a){console.error("初始化失败:",a)}finally{i.value=!1}},h=async()=>{if(!l.value.title)return alert("标题不能为空");try{const a=JSON.stringify({author:l.value.author,content:l.value.content,cover:l.value.cover}),t={title:l.value.title,status:l.value.status,channel_id:l.value.channel_id,info:a};let e;u.value?e=await f.update(r,t):e=await f.add(t),e.code===200||e.msg&&e.msg.includes("成功")?(alert("保存成功"),await p.push({name:"ArticleList"})):alert("保存失败: "+(e.msg||"未知错误"))}catch{alert("请求异常")}};return x(_),(a,t)=>(c(),d("div",S,[o("div",B,[o("h2",null,A(u.value?"编辑文章":"新增文章"),1),o("button",{onClick:t[0]||(t[0]=e=>k(p).back())},"返回")]),i.value?(c(),d("div",J,"加载中...")):(c(),d("div",L,[o("div",O,[t[7]||(t[7]=o("label",null,"文章标题:",-1)),n(o("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>l.value.title=e),placeholder:"请输入标题"},null,512),[[v,l.value.title]])]),o("div",T,[o("div",j,[t[8]||(t[8]=o("label",null,"作者:",-1)),n(o("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>l.value.author=e)},null,512),[[v,l.value.author]])]),o("div",E,[t[9]||(t[9]=o("label",null,"文章封面图:",-1)),U(M,{modelValue:l.value.cover,"onUpdate:modelValue":t[3]||(t[3]=e=>l.value.cover=e)},null,8,["modelValue"]),t[10]||(t[10]=o("p",{class:"hint"},"支持上传到 Cloudflare R2",-1))])]),o("div",F,[t[11]||(t[11]=o("label",null,"正文内容:",-1)),n(o("textarea",{"onUpdate:modelValue":t[4]||(t[4]=e=>l.value.content=e),rows:"15",placeholder:"支持 HTML 或纯文本"},null,512),[[v,l.value.content]])]),o("div",I,[t[14]||(t[14]=o("label",null,"显示状态:",-1)),o("div",q,[o("label",null,[n(o("input",{type:"radio",value:1,"onUpdate:modelValue":t[5]||(t[5]=e=>l.value.status=e)},null,512),[[b,l.value.status]]),t[12]||(t[12]=y(" 显示",-1))]),o("label",null,[n(o("input",{type:"radio",value:2,"onUpdate:modelValue":t[6]||(t[6]=e=>l.value.status=e)},null,512),[[b,l.value.status]]),t[13]||(t[13]=y(" 隐藏",-1))])])]),o("div",{class:"footer"},[o("button",{class:"btn-save",onClick:h},"提交保存文章")])]))]))}},X=w(H,[["__scopeId","data-v-a561856f"]]);export{X as default};
