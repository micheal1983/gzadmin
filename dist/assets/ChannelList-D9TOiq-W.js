import{_ as M,i as S,c as n,a as e,F as b,k as y,t as r,w as _,v as h,l as V,m as L,j as d,o}from"./index-J5bTViEi.js";import{c}from"./channel-DtUzXAka.js";import"./request-CgiPNpti.js";const N={class:"channel-page"},B={class:"data-table"},E={key:0},I=["onClick"],U=["onClick"],$={key:2},A={key:0,class:"modal-mask"},F={class:"modal-content"},R={class:"form-item"},j={class:"form-item"},P=["value"],T={class:"form-item"},q={class:"modal-btns"},z={__name:"ChannelList",setup(G){const v=d([]),m=d([]),k=d(!0),u=d(!1),i=d(!1),g=d(null),s=d({name:"",model_id:"",remark:""}),f=async()=>{k.value=!0;try{const[t,l]=await Promise.all([c.getList(),c.getModels()]);t.code===200&&(v.value=t.data),l.code===200&&(m.value=l.data)}catch(t){console.error("加载失败",t)}finally{k.value=!1}},C=t=>{i.value=!0,g.value=t.id,s.value={name:t.name,model_id:t.model_id,remark:t.remark},u.value=!0},x=()=>{i.value=!1,s.value={name:"",model_id:m.value[0]?.id||"",remark:""},u.value=!0},w=async()=>{try{const t=i.value?await c.update(g.value,s.value):await c.add(s.value);Number(t.code)===200||t.msg&&(t.msg.includes("成功")||t.msg.includes("完成"))?(alert(i.value?"修改成功":"添加成功"),u.value=!1,f()):alert("操作未成功: "+(t.msg||"未知错误"))}catch{alert("提交失败，请检查网络或后端配置")}},D=async t=>{if(confirm("确定删除该频道吗？"))try{const l=await c.delete(t);Number(l.code)===200||l.msg&&l.msg.includes("成功")?f():alert("删除失败："+l.msg)}catch{alert("请求异常")}};return S(f),(t,l)=>(o(),n("div",N,[e("div",{class:"header"},[l[4]||(l[4]=e("h2",null,"频道管理 (Channels)",-1)),e("button",{class:"btn-add",onClick:x},"新建频道")]),e("table",B,[l[7]||(l[7]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"频道名称"),e("th",null,"所属模型"),e("th",null,"备注"),e("th",null,"操作")])],-1)),e("tbody",null,[k.value?(o(),n("tr",E,[...l[5]||(l[5]=[e("td",{colspan:"5",style:{"text-align":"center",padding:"20px",color:"#999"}}," 数据加载中，请稍候... ",-1)])])):v.value.length>0?(o(!0),n(b,{key:1},y(v.value,a=>(o(),n("tr",{key:a.id},[e("td",null,r(a.id),1),e("td",null,r(a.name),1),e("td",null,r(m.value.find(p=>p.id===a.model_id)?.remark||"未知模型"),1),e("td",null,r(a.remark),1),e("td",null,[e("button",{onClick:p=>C(a)},"编辑",8,I),e("button",{class:"text-red",onClick:p=>D(a.id)},"删除",8,U)])]))),128)):(o(),n("tr",$,[...l[6]||(l[6]=[e("td",{colspan:"5",style:{"text-align":"center",padding:"20px",color:"#999"}}," 暂无频道数据 ",-1)])]))])]),u.value?(o(),n("div",A,[e("div",F,[e("h3",null,r(i.value?"修改频道":"新增频道"),1),e("div",R,[l[8]||(l[8]=e("label",null,"频道名称:",-1)),_(e("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>s.value.name=a)},null,512),[[h,s.value.name]])]),e("div",j,[l[9]||(l[9]=e("label",null,"所属模型:",-1)),_(e("select",{"onUpdate:modelValue":l[1]||(l[1]=a=>s.value.model_id=a)},[(o(!0),n(b,null,y(m.value,a=>(o(),n("option",{key:a.id,value:a.id},r(a.remark),9,P))),128))],512),[[V,s.value.model_id]])]),e("div",T,[l[10]||(l[10]=e("label",null,"备注说明:",-1)),_(e("textarea",{"onUpdate:modelValue":l[2]||(l[2]=a=>s.value.remark=a)},null,512),[[h,s.value.remark]])]),e("div",q,[e("button",{onClick:l[3]||(l[3]=a=>u.value=!1)},"取消"),e("button",{class:"btn-confirm",onClick:w},"保存")])])])):L("",!0)]))}},O=M(z,[["__scopeId","data-v-cd2849da"]]);export{O as default};
