import{_ as h,o as n,c as r,a,t as p,y as _,z as k,m as w,x as C,j as f}from"./index-J5bTViEi.js";const b={class:"upload-wrapper"},I=["src"],x={key:1,class:"placeholder"},D={key:0,class:"file-info"},N="https://pub-2c62c63b2d3a4a479a367f3d7d3eadf6.r2.dev",S={__name:"UploadImage",props:{modelValue:String},emits:["update:modelValue"],setup(l,{emit:v}){const s=l,u=v,m=f(null),t=f(!1),g=C(()=>s.modelValue?s.modelValue.startsWith("http")?s.modelValue:`${N}/${s.modelValue}`:""),y=()=>{t.value||m.value.click()},V=async i=>{const e=i.target.files[0];if(!e)return;t.value=!0;const c=new FormData;c.append("file",e);try{const o=await fetch("/api/upload",{method:"POST",body:c});if(o.status===404)throw new Error("未找到上传接口，请检查是否使用了 wrangler 启动项目");const d=await o.json();d.success?u("update:modelValue",d.fileName):alert("上传失败: "+d.error)}catch(o){alert(o.message||"上传异常")}finally{t.value=!1,i.target.value=""}};return(i,e)=>(n(),r("div",b,[a("div",{class:_(["upload-area",{loading:t.value}]),onClick:y},[l.modelValue?(n(),r("img",{key:0,src:g.value,class:"preview"},null,8,I)):(n(),r("div",x,[e[1]||(e[1]=a("span",{class:"icon"},"+",-1)),a("p",null,p(t.value?"上传中...":"点击上传封面"),1)])),a("input",{type:"file",ref_key:"fileInput",ref:m,onChange:V,accept:"image/*",style:{display:"none"}},null,544)],2),l.modelValue?(n(),r("div",D,[a("code",null,p(l.modelValue),1),a("button",{class:"btn-del",onClick:e[0]||(e[0]=k(c=>u("update:modelValue",""),["stop"]))},"移除")])):w("",!0)]))}},U=h(S,[["__scopeId","data-v-3f759b04"]]);export{U as C};
